---
layout: post
title: 'Extjs 4 :  Converting treestore into store using associations. '
date: '2014-03-18T11:13:00.001-07:00'
author: Balagangadhar Addanki
tags:
- extjs4
modified_time: '2014-06-12T10:49:27.523-07:00'
blogger_id: tag:blogger.com,1999:blog-2232263284250046405.post-7357260721122682180
blogger_orig_url: http://www.balasblog.com/2014/03/extjs-4-converting-treestore-into-store.html
---

Extjs doesn't support updating tree by keeping nodes in its own hierarchy. treestore.sync90 function only sends updated nodes to the server as individual models. But sometimes we may need to send tree structure in the form of tree to the server(Ofcourse only updated nodes).<br /><br />For example consider following tree,<br />Parent1<br /><ul><li>Child1</li><li>Child2</li><li>Child3 </li></ul>Parent2<br /><ul><li>Chld4</li><li>Child5 </li></ul>&nbsp;If&nbsp; child2 and child5 are dirty records and if we fire treestore.sync(), it only sends child2 and child5 models as data. We loose the context of parent. We may not know for which parent this child belongs to. In such a case you can use following model and code snippet to convert your tree into model with associated models.<br /><br />Each node will have subtree models as associated model and using following function, you can convert modified tree nodes into associated-model store. This store is a plain store with associated models. Now you can send this model to the server<br />(For more info on sending updated model associations to the server viz following blog post<br /><a href="http://balu-learnings.blogspot.in/2014/03/extjs-4-sending-updated-models-to.html">http://balu-learnings.blogspot.in/2014/03/extjs-4-sending-updated-models-to.html</a> ). <br /><br /><u><b>model :</b></u><br /><br />Ext.define('App.model.treegridsample', {<br />&nbsp;&nbsp;&nbsp; extend : 'Ext.data.Model',<br />&nbsp;&nbsp;&nbsp; fields : [ {<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; name : 'id',<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; useNull : true,<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; defaultValue : ''<br />&nbsp;&nbsp;&nbsp; }{<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; name : 'text'<br />&nbsp;&nbsp;&nbsp; }{<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; name : 'leaf',<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; persist : false<br />&nbsp;&nbsp;&nbsp; }],<br /><br />&nbsp;&nbsp;&nbsp; associations : [ {<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; type : 'hasMany',<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; model : 'App.model.treegridsample',<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; name : 'children'<br />&nbsp;&nbsp;&nbsp; }<br />});<br /><br /><br /><u><b>CustomTree.js</b></u><br />&nbsp;&nbsp;  <br /><div id="" style="height: 300px; overflow: scroll;"><pre>Ext.define('App.view.common.CustomTree', {<br /> extend : 'Ext.tree.Panel',<br /> convertToStore : function(model) {<br />  if (this.getStore() === null) {<br />   return null;<br />  }<br />  var rootNode = this.getStore().getRootNode();<br />  model = model || Ext.getClassName(this.getStore().getRootNode());<br />  dataStore = this.convertNodeToStore(rootNode, model);<br />  return dataStore.childrenStore;<br /> },<br />convertNodeToStore : function(rootNode, model) {<br /> var record = Ext.create(model);<br /> record.data = rootNode.data;<br /> if (record.childrenStore === null || typeof record.childrenStore === 'undefined') {<br />  record.childrenStore = Ext.create('Ext.data.Store', {<br />   model : model<br />  });<br /> }<br /> for (var i = 0; i &lt; rootNode.childNodes.length; i++) {<br />  var cNode = rootNode.childNodes[i];<br />  var child = this.convertNodeToStore(cNode, model);<br />  if (cNode.dirty || cNode.phantom) {<br />   record.childrenStore.add(child);<br />   rootNode.setDirty();<br />  }<br /> }<br /> return record;<br />}<br /></pre></div><br /><br />Source can be found@&nbsp;<a href="https://github.com/Balagangadhar/ExtJS4-Misc/blob/master/CustomTree.js" target="_blank">https://github.com/Balagangadhar/ExtJS4-Misc/blob/master/CustomTree.js</a><br /><br />